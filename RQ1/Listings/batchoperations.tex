\begin{minipage}{0.95\linewidth}
    \begin{lstlisting}[caption={Usage of job scheduling in implementation to be able to batch operations}, label={BatchOperationsCode}]
def start_process():
    _create_and_return_bills()

    some_job = django_rq.enqueue(_setup, jobs,
                                job_timeout=7200)
    bill_jobs = []

    # Generate bills using workers.
    for bill in list_of_bills:
        bill_jobs.append(
            django_rq.enqueue(_generate_bill, bill, 
                                some_job.id,
                                depends_on=some_job))
                              
    # Bills for user are calculated concurrently
    bill_jobs.append(django_rq.enqueue(
        set_total_costs_for_billing, 
        all_bills, depends_on=bill_jobs))
    django_rq.enqueue(concat_files, all_bills, 
        depends_on=bill_jobs)
    ...
\end{lstlisting}
\end{minipage}

\begin{comment}
\begin{minipage}{\linewidth}
    \begin{lstlisting}[caption={Example implementation showing the usage of Redis job scheduling in order to batch billing calculations.}, label={BatchOperationsCode}]
def start_billing_process():
    ...
    rate_calculation_job = django_redis_queue.enqueue(_setup, billing_run, 
                                                      job_timeout=7200)
    list_of_jobs = []

    # Generate bills using Redis workers.
    for bill in list_of_bills:
        list_of_jobs.append(
            django_redis_queue.enqueue(_generate_bill, bill_for_user,
                                        rate_calculation_job.id,
                                        depends_on=rate_calculation_job))
                              
    
    # Concatenate all individual bills.
    django_redis_queue.enqueue(concat_files, all_bills, depends_on=list_of_jobs)
    ...
\end{lstlisting}
\end{minipage}
\end{comment}